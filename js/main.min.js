(function(){const reduceMotionQuery=typeof window.matchMedia==="function" ? window.matchMedia("(prefers-reduced-motion:reduce)"):{matches:false};const prefersReducedMotion=!!reduceMotionQuery && reduceMotionQuery.matches;const navToggle=document.querySelector(".nav-toggle");const nav=document.querySelector(".site-nav");const onDocumentKeydown=(event)=>{if(!nav || !nav.classList.contains("open"))return;if(event.key==="Escape"){closeNav();navToggle?.focus();}else if(event.key==="Tab"){const focusable=[navToggle,...nav.querySelectorAll("a")].filter((el)=>el && el.offsetParent !==null);if(!focusable.length)return;const first=focusable[0];const last=focusable[focusable.length-1];if(event.shiftKey && document.activeElement===first){event.preventDefault();last.focus();}else if(!event.shiftKey && document.activeElement===last){event.preventDefault();first.focus();}}};const onDocumentClick=(event)=>{if(!nav || !nav.classList.contains("open"))return;if(!nav.contains(event.target)&& !navToggle.contains(event.target)){closeNav();}};function openNav(){if(!navToggle || !nav)return;nav.classList.add("open");navToggle.classList.add("is-open");navToggle.setAttribute("aria-expanded","true");const firstLink=nav.querySelector("a");if(firstLink)firstLink.focus();document.addEventListener("keydown",onDocumentKeydown);document.addEventListener("click",onDocumentClick);}function closeNav(){if(!navToggle || !nav)return;nav.classList.remove("open");navToggle.classList.remove("is-open");navToggle.setAttribute("aria-expanded","false");document.removeEventListener("keydown",onDocumentKeydown);document.removeEventListener("click",onDocumentClick);}if(navToggle && nav){navToggle.setAttribute("aria-expanded","false");navToggle.addEventListener("click",()=>{const isOpen=nav.classList.contains("open");if(isOpen){closeNav();}else{openNav();}});nav.querySelectorAll("a").forEach((link)=>{link.addEventListener("click",()=>closeNav());});}document.querySelectorAll("[data-scroll-to]").forEach((el)=>{el.addEventListener("click",(event)=>{const target=el.getAttribute("data-scroll-to")|| el.getAttribute("href");if(!target || !target.startsWith("#"))return;if(prefersReducedMotion)return;const node=document.querySelector(target);if(!node)return;event.preventDefault();node.scrollIntoView({behavior:"smooth",block:"start",});});});const panelTemplates=new Map(Array.from(document.querySelectorAll("template[data-panel]")).map((template)=>[template.dataset.panel,template.content,]));const ensurePanelContent=(panelId)=>{const panel=document.getElementById(panelId);if(!panel || panel.childElementCount)return;const tpl=panelTemplates.get(panelId);if(tpl){panel.appendChild(tpl.cloneNode(true));}};const tabs=Array.from(document.querySelectorAll('[role="tab"]'));const activateTab=(tab)=>{tabs.forEach((t)=>{const isActive=t===tab;t.classList.toggle("active",isActive);t.setAttribute("aria-selected",isActive ? "true":"false");t.setAttribute("tabindex",isActive ? "0":"-1");const panelId=t.getAttribute("aria-controls");const panel=panelId ? document.getElementById(panelId):null;if(panel){if(isActive)ensurePanelContent(panelId);panel.hidden=!isActive;}});};tabs.forEach((tab)=>{tab.addEventListener("click",()=>activateTab(tab));tab.addEventListener("keydown",(event)=>{const index=tabs.indexOf(tab);let target;if(event.key==="ArrowRight" || event.key==="ArrowDown"){target=tabs[(index+1)% tabs.length];}else if(event.key==="ArrowLeft" || event.key==="ArrowUp"){target=tabs[(index-1+tabs.length)% tabs.length];}else if(event.key==="Home"){target=tabs[0];}else if(event.key==="End"){target=tabs[tabs.length-1];}if(target){event.preventDefault();activateTab(target);target.focus();}});});const revealTargets=Array.from(document.querySelectorAll(".hero-copy,.hero-panel,.hero-panel-table,.hero-panel-metrics,.story-card,.how-card,.benefit-list li,.metric-card,.platform-window,.platform-chip-row,.cta-form"));if(prefersReducedMotion){revealTargets.forEach((el)=>el.classList.add("reveal-in"));}else if("IntersectionObserver" in window){const observer=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(entry.isIntersecting){entry.target.classList.add("reveal-in");observer.unobserve(entry.target);}});},{threshold:0.18,rootMargin:"0px 0px-40px 0px"});revealTargets.forEach((el)=>{el.classList.add("reveal");observer.observe(el);});}else{revealTargets.forEach((el)=>el.classList.add("reveal-in"));}const form=document.querySelector(".cta-form");const status=document.querySelector(".form-status");const setStatus=(message,state="info")=>{if(!status)return;status.textContent=message;status.dataset.state=state;};if(form){let isSubmitting=false;form.addEventListener("submit",async(event)=>{event.preventDefault();if(isSubmitting)return;if(!form.checkValidity()){form.reportValidity();return;}if(typeof window.fetch !=="function"){form.submit();return;}setStatus("Sending...","pending");isSubmitting=true;const submitButton=form.querySelector('[type="submit"]');if(submitButton){submitButton.disabled=true;}const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),10000);const formData=new FormData(form);try{const response=await fetch(form.action || window.location.href,{method:form.method || "post",body:formData,keepalive:true,signal:controller.signal,});if(!response.ok)throw new Error("Request failed");setStatus("Thanks. We’ll be in touch shortly.","success");form.reset();}catch(err){setStatus("We couldn’t submit right now. Please email admin@taxat.co.uk.","error");}finally{clearTimeout(timeoutId);isSubmitting=false;if(submitButton){submitButton.disabled=false;}}});}const footerYear=document.querySelector(".footer-meta span");if(footerYear){const currentYear=new Date().getFullYear();footerYear.textContent=footerYear.textContent.replace(/\d{4}/,currentYear);}})();